{% extends "base.html" %}
{% block title %} Suivie des absences {% endblock %}
{% block main %}

<div class="container-fluid py-3">

  <h5 class="fw-bold text-uppercase mb-3">
    Suivi mensuel des absences des enseignants
  </h5>

  <!-- ðŸ”½ FILTRE -->
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <form method="get" class="row g-3 align-items-end">

        <div class="col-md-3">
          <label class="form-label fw-semibold">Enseignant</label>
          <select name="prof" class="form-select">
            <option value="">Tous les enseignants</option>
            {% for p in profs %}
              <option value="{{ p.id }}" {% if prof_id == p.id|stringformat:"s" %}selected{% endif %}>
                {{ p.nom_conplet }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">Mois</label>
          <select name="mois" class="form-select">
            {% for m in "123456789101112"|make_list %}
              <option value="{{ forloop.counter }}"
                {% if mois == forloop.counter %}selected{% endif %}>
                {{ forloop.counter|stringformat:"02d" }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">AnnÃ©e scolaire</label>
          <select name="annee_id" class="form-select">
            {% for a in annees_db %}
              <option value="{{ a.id }}" {% if annee_id == a.id|stringformat:"s" %}selected{% endif %}>
                {{ a.nom }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3">
          <button class="btn btn-success w-100 fw-semibold" type="submit">
            Filtrer
          </button>
        </div>

      </form>
    </div>
  </div>

  <!-- ðŸ“‹ TABLE -->
  <div class="card shadow-sm">
    <div class="card-body">

      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Date</th>
              <th>Enseignant</th>
              <th>Heures</th>
              <th>Statut</th>
              <th>Motif</th>
              <th>JustifiÃ©e</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody>
            {% for r in rows %}
            <tr>
              <td>{{ r.date|date:"d/m/Y" }}</td>
              <td>{{ r.professeur.nom_conplet }}</td>
              <td>
                {% if r.h_debut %}
                  {{ r.h_debut }} â†’ {{ r.h_fin|default:"--" }}
                {% else %}
                  â€”
                {% endif %}
              </td>
              <td>
                {% if r.statut == "absence" %}
                  <span class="badge bg-danger">Absence</span>
                {% elif r.statut == "retard" %}
                  <span class="badge bg-warning text-dark">Retard</span>
                {% else %}
                  <span class="badge bg-success">PrÃ©sent</span>
                {% endif %}
              </td>
              <td>{{ r.motif|default:"â€”" }}</td>
              <td>
                {% if r.justifiee %}
                  <span class="badge bg-success">Oui</span>
                {% else %}
                  <span class="badge bg-secondary">Non</span>
                {% endif %}
              </td>
              <td>
                <form method="post" onsubmit="return confirm('Supprimer cette absence ?')">
                  {% csrf_token %}
                  <input type="hidden" name="delete_id" value="{{ r.id }}">
                  <button class="btn btn-sm btn-outline-danger">
                    Supprimer
                  </button>
                </form>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="7" class="text-center text-muted py-4">
                Aucune absence pour ce mois
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>

</div>

{% endblock %}
