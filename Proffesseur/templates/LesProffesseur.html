{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Liste des enseignants" %}{% endblock %}
{% block main %}

<style>
  .rtl .table, .rtl .table * { direction: rtl; }
  .badges{display:flex;flex-wrap:wrap;gap:6px}
  .rtl .badges{justify-content:flex-end}
</style>

<div class="container py-4 {% if request.LANGUAGE_CODE == 'ar' %}rtl{% endif %}">
  <a href="{% url 'AjouterProfesseur' %}" class="btn btn-outline-primary mb-3">
    {% trans "Ajouter un Professeur" %}
  </a>

  <h3 class="mb-3 text-dark">{% trans "Liste des enseignants" %}</h3>

  <form action="" method="get" class="row g-2 mb-3">
    <div class="col-md-4">
      <input type="text" name="nom_conplet" value="{{ request.GET.nom_conplet }}"
             class="form-control bg-light" placeholder="{% trans 'Nom complet' %}">
    </div>

    <div class="col-md-3">
      <select name="status" class="form-control">
        <option value="">{% trans "Statut" %}</option>
        <option value="Permanent" {% if request.GET.status == "Permanent" %}selected{% endif %}>{% trans "Permanent" %}</option>
        <option value="Vacataire" {% if request.GET.status == "Vacataire" %}selected{% endif %}>{% trans "Vacataire" %}</option>
        <option value="Stagiaire" {% if request.GET.status == "Stagiaire" %}selected{% endif %}>{% trans "Stagiaire" %}</option>
      </select>
    </div>

    <div class="col-md-3">
      <select name="actif" class="form-control">
        <option value="">{% trans "Actif" %}</option>
        <option value="True"  {% if request.GET.actif == "True" %}selected{% endif %}>{% trans "Oui" %}</option>
        <option value="False" {% if request.GET.actif == "False" %}selected{% endif %}>{% trans "Non" %}</option>
      </select>
    </div>

    <div class="col-md-2">
      <button type="submit" class="btn btn-primary w-100">{% trans "Rechercher" %}</button>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-primary">
        <tr>
          <th>#</th>
          <th>{% trans "Nom complet" %}</th>
          <th>{% trans "Matières" %}</th>
          <th>{% trans "Classes" %}</th>
          <th>{% trans "Diplôme" %}</th>
          <th>{% trans "Date d'embauche" %}</th>
          <th>{% trans "Statut" %}</th>
          <th>{% trans "Actif" %}</th>
          <th>{% trans "Détail" %}</th>
          <th>{% trans "Modifier" %}</th>
          <th>{% trans "Supprimer" %}</th>
        </tr>
      </thead>

      <tbody>
        {% for prof in profs %}
          <tr>
            <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
            <td>{{ prof.nom_conplet }}</td>

            <td>
              <div class="badges">
                {% for m in prof.matieres.all %}
                  <span class="badge bg-info text-dark">{{ m }}</span>
                {% empty %}
                  <span class="text-muted">—</span>
                {% endfor %}
              </div>
            </td>

            <td>
              <div class="badges">
                {% for c in prof.classes.all %}
                  <span class="badge bg-secondary">{{ c.nom }}</span>
                {% empty %}
                  <span class="text-muted">—</span>
                {% endfor %}
              </div>
            </td>

            <td>
              {% if prof.diplome %}
                <a href="{{ prof.diplome.url }}" target="_blank">{% trans "Voir" %}</a>
              {% else %}
                <span class="text-muted">{% trans "Aucun" %}</span>
              {% endif %}
            </td>

            <td>{{ prof.date_empauche }}</td>
            <td>{{ prof.get_status_display }}</td>

            <td>
              {% if prof.actif %}
                <span class="badge bg-success">{% trans "Oui" %}</span>
              {% else %}
                <span class="badge bg-danger">{% trans "Non" %}</span>
              {% endif %}
            </td>

            <td><a href="{% url 'LesDetailleDeProf' prof.pk %}" class="btn btn-sm btn-outline-primary">{% trans "Voir" %}</a></td>
            <td><a href="{% url 'ModifieProfesseur' prof.pk %}" class="btn btn-sm btn-outline-success">{% trans "Modifier" %}</a></td>
            <td><a href="{% url 'DeleteProf' prof.pk %}" class="btn btn-sm btn-outline-danger">{% trans "Supprimer" %}</a></td>
          </tr>
        {% empty %}
          <tr><td colspan="11" class="text-center text-muted">{% trans "Aucun professeur trouvé." %}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">

        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?{% if qs %}{{ qs }}&{% endif %}page=1">&laquo; {% trans "Première" %}</a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?{% if qs %}{{ qs }}&{% endif %}page={{ page_obj.previous_page_number }}">{% trans "Précédent" %}</a>
          </li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
          {% if page_obj.number == num %}
            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
          {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <li class="page-item">
              <a class="page-link" href="?{% if qs %}{{ qs }}&{% endif %}page={{ num }}">{{ num }}</a>
            </li>
          {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?{% if qs %}{{ qs }}&{% endif %}page={{ page_obj.next_page_number }}">{% trans "Suivant" %}</a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?{% if qs %}{{ qs }}&{% endif %}page={{ page_obj.paginator.num_pages }}">{% trans "Dernière" %} &raquo;</a>
          </li>
        {% endif %}

      </ul>
    </nav>
  {% endif %}
</div>

{% endblock %}
