{% extends 'base.html'%}
{% load i18n l10n humanize %}
{% block title %}{% trans "Page de detaille" %}{% endblock %}
{% block main %}


  <style>
/* ---------- PRINT FIX ---------- */
@media print {

  /* 1) cacher tout sauf la fiche */
  body * { visibility: hidden; }
  #fiche-eleve, #fiche-eleve * { visibility: visible; }

  /* 2) remettre la fiche dans le flux (ne pas absolute, sinon ça casse les colonnes) */
  #fiche-eleve{
    position: static !important;
    width: 100% !important;
    margin: 0 !important;
  }

  /* 3) forcer le système 2 colonnes même sans bootstrap */
  #fiche-eleve .row{
    display: flex !important;
    flex-wrap: wrap !important;
  }

  /* si tu utilises col-md-6 */
  #fiche-eleve .col-md-6{
    flex: 0 0 50% !important;
    max-width: 50% !important;
  }

  /* sur petits formats (optionnel) */
  @page { size: A4; margin: 12mm; }

  /* images */
  img { max-width: 100% !important; height: auto !important; }

  /* éviter que des sections se coupent mal */
  .card, table, tr, p { break-inside: avoid; page-break-inside: avoid; }
}
</style>


<div style="margin-bottom: 2rem;" class="container">

  <!-- <button type="button" class="btn btn-sm btn-primary">
    <a class="btn btn-sm btn-primary" href="{% url 'addEleveAbsence' eleve.id %}">
      {% trans "Ajouter une Absence" %}
    </a>
  </button>

  <button type="button" class="btn btn-sm btn-secondary">
    <a class="btn btn-sm btn-secondary" href="{% url 'paiment_par_eleve' eleve.id %}">
      {% trans "Ajouter un Paiement" %}
    </a>
  </button> -->

  <!-- <button type="button" class="btn btn-sm btn-danger">
    <a class="btn btn-sm btn-danger" href="{% url 'Notes_eleve' eleve.id %}">
      {% trans "Ajouter une Note" %}
    </a>
  </button>

  <button type="button" class="btn btn-sm btn-success">
    <a class="btn btn-sm" href="{% url 'messageParEleve' eleve.id %}">
      {% trans "Envoyer un message" %}
    </a>
  </button> -->

  <button type="button" class="btn btn-info" onclick="printFiche()">
    {% trans "Imprimer la fiche" %}
  </button>

  <!-- <a class="btn btn-sm" href="{% url 'bulletin_bdf' eleve.id %}">
    {% trans "Generer un Bulletin" %}
  </a> -->
</div>

<div style="background-color: white; color: black;" class="container">
  <a href="{% url 'les_eleves'%}" class="btn btn-sm btn-outline-success m-3">Retour</a>
  <div id="fiche-eleve">
    <div class="row">
      <div class="col-md-6">
        <h4>{% trans "Information de l'eleve" %}</h4>
        <hr>
        <p>
          {% trans "Nom" %}: {{ eleve.nom }} <br>
          {% trans "Sexe" %}: {{ eleve.Sexe }} <br>
          {% trans "Date de naissance" %}: {{ eleve.date_naissancce }} <br>
          {% trans "Classe" %}: {{ eleve.classe }} <br>
          {% trans "Ecole" %}: {{ eleve.ecole }} <br>
          {% trans "Adresse" %}: {{ eleve.adrress }} <br>
          {% trans "Status" %}: {{ eleve.get_status_display }}
        </p>

        <hr>
        <p>
          {% trans "Nom du parent" %}: {{ eleve.parent }} <br>
          {% trans "Contact primaire" %}: {{ eleve.telephone }} <br>
          {% trans "Contact secondaire" %}: {{ eleve.telephone_parent }} <br>
          {% trans "Email" %}: {{ eleve.email_parent }}
        </p>
      </div>

      <div class="col-md-6">
        <img style="border-radius: 20px; margin-left: 2rem;"
             src="{{ eleve.photo.url }}"
             height="120" width="90" alt="">
        <br>
        <span>{{ eleve.classe }}</span>

        <h5 style="margin-top: 1rem;">{% trans "Resume des frais" %}</h5>
        <hr>
        <p>
          <strong>{% trans "Total a payer" %}:</strong> {{ total_frais|floatformat:0|intcomma }} DJF <br>
          <strong>{% trans "Total paye" %}:</strong> {{ total_paye|floatformat:0|intcomma }} DJF <br>
          <strong>{% trans "Reste a payer" %}:</strong> {{ total_reste|floatformat:0|intcomma }} DJF
        </p>
      </div>
    </div>

    <hr class="my-4">

    <!-- ✅ TABLE: FRAIS PAR TYPE -->
    <h5 class="mb-2">{% trans "Frais par type de paiement" %}</h5>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-primary">
          <tr>
            <th>{% trans "Type" %}</th>
            <th class="text-end">{% trans "Montant" %}</th>
            <th class="text-end">{% trans "Paye" %}</th>
            <th class="text-end">{% trans "Reste" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for row in frais_par_type %}
            <tr>
              <td>{{ row.type_label }}</td>
              <td class="text-end">{{ row.montant|floatformat:0|intcomma }} {{ row.devise }}</td>
              <td class="text-end">{{ row.paye|floatformat:0|intcomma }} {{ row.devise }}</td>
              <td class="text-end">{{ row.reste|floatformat:0|intcomma }} {{ row.devise }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" class="text-center">{% trans "Aucun frais defini" %}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- ✅ TABLE: HISTORIQUE PAIEMENTS -->
    <h5 class="mt-4 mb-2">{% trans "Historique des paiements" %}</h5>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-secondary">
          <tr>
            <th>{% trans "Date" %}</th>
            <th>{% trans "Type" %}</th>
            <th>{% trans "Mode" %}</th>
            <th>{% trans "Reference" %}</th>
            <th class="text-end">{% trans "Montant" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for p in paiements %}
            <tr>
              <td>{{ p.date_paiement }}</td>
              <td>{{ p.frais_eleve.type_paiement }}</td>
              <td>{{ p.get_mode_display }}</td>
              <td>{{ p.reference|default:"-" }}</td>
              <td class="text-end">{{ p.montant|floatformat:0|intcomma }} {{ p.devise }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="5" class="text-center">{% trans "Aucun paiement" %}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>
<script>
function printFiche(){
  window.print();
}
</script>


{% endblock %}
