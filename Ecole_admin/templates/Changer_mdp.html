{% extends "base.html" %}
{% block title %}Changer mot de passe{% endblock %}
{% block main %}

<div class="container-fluid px-4 py-4">
  <div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">

      <div class="card shadow-sm">
        <div class="card-header bg-white">
          <h5 class="m-0 fw-bold">ğŸ”’ Changer le mot de passe</h5>
          <div class="text-muted small">
            Compte : <span class="fw-semibold">{{ request.user.username }}</span>
          </div>
        </div>

        <div class="card-body">

          {% if messages %}
            {% for m in messages %}
              <div class="alert alert-{{ m.tags }} py-2 mb-3">{{ m }}</div>
            {% endfor %}
          {% endif %}

          <form method="post" novalidate>
            {% csrf_token %}

            <!-- Ancien mot de passe -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Ancien mot de passe</label>
              <div class="input-group">
                {{ form.old_password.as_widget|safe }}
                <button class="btn btn-outline-secondary toggle-pass" type="button"
                        data-target="id_old_password" aria-label="Afficher/Masquer">
                  ğŸ‘ï¸
                </button>
              </div>
              {% for e in form.old_password.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
            </div>

            <!-- Nouveau mot de passe -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Nouveau mot de passe</label>
              <div class="input-group">
                {{ form.new_password1.as_widget|safe }}
                <button class="btn btn-outline-secondary toggle-pass" type="button"
                        data-target="id_new_password1" aria-label="Afficher/Masquer">
                  ğŸ‘ï¸
                </button>
              </div>
              {% for e in form.new_password1.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
            </div>

            <!-- Confirmer -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Confirmer le nouveau mot de passe</label>
              <div class="input-group">
                {{ form.new_password2.as_widget|safe }}
                <button class="btn btn-outline-secondary toggle-pass" type="button"
                        data-target="id_new_password2" aria-label="Afficher/Masquer">
                  ğŸ‘ï¸
                </button>
              </div>
              {% for e in form.new_password2.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
            </div>

            {% if form.non_field_errors %}
              <div class="alert alert-danger py-2">
                {{ form.non_field_errors }}
              </div>
            {% endif %}

            <div class="d-flex justify-content-end gap-2">
              <a href="{% url 'Acceuil' %}" class="btn btn-light">Retour</a>
              <button type="submit" class="btn btn-primary">âœ… Modifier</button>
            </div>
          </form>
        </div>
      </div>

    </div>
  </div>
</div>

<style>
  /* petit style pour rendre l'oeil bien */
  .toggle-pass { min-width: 48px; }
</style>

<script>
  (function () {
    const btns = document.querySelectorAll(".toggle-pass");
    btns.forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-target");
        const input = document.getElementById(id);
        if (!input) return;

        if (input.type === "password") {
          input.type = "text";
          btn.textContent = "ğŸ™ˆ";
        } else {
          input.type = "password";
          btn.textContent = "ğŸ‘ï¸";
        }
      });
    });
  })();
</script>

{% endblock %}
